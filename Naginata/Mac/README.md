# Mac を 薙刀式 v13完成版（仮） にするスクプリト

* 薙刀式.json

Windows版、QMK版の薙刀式は、押したキーをどれか離すと計算がおこなわれ、画面に出力されます。

ですが、Mac の Karabier-Elements ではキーを押したときに、離したときの動作が決まってしまい、後で変えられません。

そこで、キーを何でも押した瞬間に出力し、もう１、２個キーを同時押ししたら、その都度戻って出し直す方法を使うようにしました。

## 使用方法

JISキーボードにもUSキーボードにも対応しています。

Karabiner-Elements で英語系の配列より上に登録してください。
他の英語系の配列が無効になりますが、Excelワークシートの書き換えで実装できます。

新配列は、パスワード入力時は無効、Command、Optionキーと併用時は有効です。

### 【重要】かわせみ2 でのみ動作します。

入力方法にローマ字入力を使うように設定してください。

macOS Mojave (10.14.6) + Karabiner-Elements (v12.10.0) + かわせみ2 (2.0.17) でテスト継続中です。

## シフト方式

スペースキー、シフトキーのどちらもシフトとして操作できます。

## 固定名詞ショートカット

一緒に公開した Excel のワークシートで、「固定名詞」タブ内に書き込んで、次の方法でスクリプトを作成し直して、入れ換えの登録をおこなってください。

1. Excel の左上の「A4」とか書いてある部分の矢印をクリックする

2. 「スクリプト」を選ぶ

3. Command + C でコピーする

4. テキストエディットで新規書類を作り、「フォーマット」から「標準テキストにする」としてからペーストする。

5. 「Naginata.json」などのファイル名でフォルダ ~/.config/karabiner/assets/complex_modifications/ に保存する

6. Karabiner-Elements で古い登録を削除して、今度作ったものを再登録する

ただし、ワークシートは Office 365版でしか動かすことができません。ネット上で動作する Office 無料版で動くかは未確認です。

Mac版Excel で「あ」と「ぁ」のような小書き文字との区別がつかないので、手動設定でしのいでいます。

１個所あたり２０文字までとしましたが、２０文字の入力に２〜６秒かかります。

# 問題点

分かっている問題点を書き出します。
テストが不十分なため、ほかにもたくさんあるとは思いますが、ご了承ください。

### 右手側のロールオーバー入力はほとんどできます。両手にまたがるものは、まずできません。

### ページ移動でページの先頭に行かない。

その方法があるかどうかも分かりません。

## １つ目のキーを押した瞬間に出力がおきるので、選択範囲を削除することが起こる。

右側の編集モードで起きますが、D+F、または C+V の２キーの組み合わせを同時押ししてから、右側のキーを押せば発生しません。

### かな変換中に V+M の改行が２回押したのと同じ状態になる

V+M を同時押ししてください。

その代わり、次の操作の前にどちらのキーも離しましょう。

# 変数

* USC: 未確定文字の数（０〜２）

例：あ＋る→ある＋し→じょ　「ある」を入力したところで２、「し」を入力されたら２文字削除して「じょ」を入力する。

確定する複数キー押し、キーを離したときは０になります。

* LKS: 直前の同時押しキーの数 （１〜２）

ロールオーバーで２キー同時押しが続くときに、１文字目が消えて新しい文字を入力されるのを避けるために用意。

３キー同時押し（シフトを数えず）は全て確定になるので、３を代入することはしない。

例：語尾、ボビン、ポピー

# 修正履歴

* Excel ワークシートの全面改定

* 編集モードの定義を見直し

* 順序の入れ替え

* 変数利用の条件替えなど
