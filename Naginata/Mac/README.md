# Mac を 薙刀式 v13完成版 にするスクプリト

Windows版、QMK版の薙刀式は、押したキーをどれか離すと計算がおこなわれ、画面に出力されます。

ですが、Mac の Karabier-Elements ではキーを押したときに、離したときの動作が決まってしまい、後で変えられません。

そこで、キーを何でも押した瞬間に出力し、もう１、２個キーを重ね押ししたら、その都度戻って出し直す方法を使うようにしました。

* Naginata_Layout.json
* Naginata-Kawasemi.json

JISキーボードにもUSキーボードにも対応しています。

使いたい方を、Karabiner-Elements で登録してください。
英語系の配列を取り除かなくてはいけません。

# 薙刀式 v13完成版 (辞書登録式・英数編集モード付)

eswai 氏作の、薙刀式カナ配列QMK版を Mac で使うための辞書登録を利用し、Karabiner-Elements と日本語IM でもなんとか薙刀式を使えるようにしたものです。

https://github.com/eswai/qmk_firmware/tree/master/keyboards/crkbd/keymaps/naginata_v13u
の 
naginata_dictionary.plist
を使って辞書登録してください。

日本語IM のライブ変換には対応させていません。日本語IM では、かなり引っ掛かりが生じます。

日本語IM では、Shift + 英数 で「全角英数」入力に切り替えます。

(インストール後サイズ: 9.1MB)

## シフト方式

スペースキー、シフトキーのどちらもシフトとして操作できます。

## 固定名詞ショートカット

実装する予定はありません。

# 薙刀式 v13完成版 +かわせみ2

### 【重要】かわせみ2 でのみ動作します。

かわせみ2 を次のように設定します。

* キー割り当て編集ツール	※好きな名前で保存する
> テンプレート元		標準タイプ

> 文節操作
>>	文節前削除:		[shift]+[delete]

* ローマ字ルール編集ツール	※好きな名前で保存する
> テンプレート元		MS-IMEタイプ
>> 追加
>>>	gww	グヮ

>>>	qww	クヮ

* 環境設定ツール
> 入力と操作
>>	ローマ字
>>>		ローマ字ルール:		上で設定したもの
>>>		shiftキーの応用:		通常 shift 動作
>>>		キャレットの移動単位:	ローマ字変換単位
>>>		記号入力:		『』二重カギ括弧
>>	操作
>>>		キー割り当て:		上で設定したもの

macOS Mojave (10.14.6) + Karabiner-Elements (v12.10.0) + かわせみ2 (2.0.17) でテスト継続中です。

(インストール後サイズ: 5.2MB)

## シフト方式

スペースキー、シフトキーのどちらもシフトとして操作できます。

## 固定名詞ショートカット

一緒に公開した Excel のワークシートで、「固定名詞」タブ内に書き込んで、次の方法でスクリプトを作成し直して、入れ換えの登録をおこなってください。

1. 「スクリプト」タブを選ぶ
2. Command + A で全てを選んでから、Command + C でコピーする
3. テキストエディットで新規書類を作り、「フォーマット」から「標準テキストにする」としてからペーストする。
4. 「Naginata.json」などのファイル名でフォルダ ~/.config/karabiner/assets/complex_modifications/ に保存する
5. Karabiner-Elements で古い登録を削除して、今度作ったものを再登録する

ワークシートは Office 365 の新機能を使っていますが、ネット上で動作する Office でも使えます。

１個所あたり２０文字までとしました。２０文字の入力に２〜６秒かかります。

## 英語系配列

英語系の配列は、Excel ワークシートの「キー設定」タブの JISキーボード の文字を入れ替え、上の方法でスクリプトを作成して登録してください。

なお、入れ替えにとどめてください。
設定がない文字があると、いまのところ正しいスクリプトが作れませんので Karabiner-Elements に登録できません。

パスワード入力時は無効、Command、Option、Controlキーと併用時も無効です。

# Q & A

### Q1. １つ目のキーを押した瞬間に出力がおきて、選択範囲が削除されますが。

A1. 編集モードは、できるだけ D+F、C+V などの隣り合う２キーの組み合わせを同時押ししてから、３つ目のキーを押してください。

「最末尾」は、選択範囲を解除してから押してください。

### Q2. かな変換中に V+M を押したら、確定+改行とになった。

A2. V+M を同時押ししてください。

そして、次の操作の前にどちらのキーも離しましょう。

### Q3. スペース、左、右、BS の反応が悪い。

A3. これらのキーは、離したときに実行されます。

### Q4. スペース、左、右、BS を長押ししてから離したら、なにも起きない。

A4. Karabiner-Elements 設定の「Complex Modifications」項目内「Parameters」タブの
「to_if_alone_timeout_milliseconds」の値を長くしてみてください。
初期設定は1000ミリ秒（１秒）です。

D+F の同時押し(シンクロ。以下同)、C+V の同時押し、J+K の同時押しから、長押ししても同じです。

### Q5. スペース(シフト)を押しながら「が」といった２キー押しをすると、「あが」などと入力される

A5. かわせみ2 のキー割り当て編集ツールで、「読み操作」内の「文節前削除」に [shift]+[delete] を加えます。

[shift]+[delete] を、カーソル位置削除としてどうしても使いたいときは、https://ke-complex-modifications.pqrs.org(公式)の Change delete key で利用できます。

## 変数

* USC: 未確定文字の数（０〜２）

例：あ＋る→ある＋し→じょ　「ある」を入力したところで２、「し」を入力されたら２文字削除して「じょ」を入力する。

確定する複数キー押し、キーを離したときは０になります。

* LKS: 直前の文字の押しキーの数 （１〜２）

ロールオーバーで２キー同時押しが続くときに、前の文字を消すことなく新しい文字を入力するために用意。

３キー押し（シフトを数えず）は全て確定になるので、３の代入を省略しています。

例：語尾、ボビン、ポピー

## 参考

* [【薙刀式】v13完成版、発表。](http://oookaworks.seesaa.net/article/479173898.html#gsc.tab=0)

## おもな修正履歴

* 「薙刀式 v13完成版」へ対応
(ここまで2020年12月27日追加)

* 「縦書き版」の「最末尾」「Home」「End」関係を修正
(ここまで2020年12月28日追加)

* スクリプトのコメントを修正
(ここまで2021年1月1日追加)

* 「辞書登録式」に使う辞書登録を、QMK版の Big Sur 対応に合わせた
* ワークシートでのコメント生成方法を修正
(ここまで2021年1月1日追加)
